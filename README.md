# Общая информация  

**STACK:** **`Django`**, **`Celery`**, **`Redis`**, **`PostgreSQL`**, **`Pandas`**, **`Numpy`**

## Что делает данный код?  
Это заготовка для сервиса, который ведет учет произведенных роботов,а также   
выполняет некие операции связанные с этим процессом.  
  
Сервис нацелен на удовлетворение потребностей трёх категорий пользователей:  
- Технические специалисты компании. Они будут присылать информацию  
- Менеджмент компании. Они будут запрашивать информацию  
- Клиенты. Им будут отправляться информация  

## Организация на уровне моделей
Каждый робот(**Robot**) имеет определенную модель выраженную двух-символьной   
последовательностью(например R2). Одновременно с этим, модель имеет различные   
версии(например D2). Напоминает популярный телефон различных моделей(11,12,13...) и его версии  
(X,XS,Pro...). Вне компании роботов чаще всего называли по серийному номеру, объединяя модель и версию(например R2-D2).  
  
Также у компании есть покупатели(**Customer**) которые периодически заказывают того или иного робота.   
  
Когда роботов нет в наличии - заказы покупателей(**Order**) попадают в список ожидания.  

## Запуск  
### Стандартный запуск
Для запуска достаточно ввести виртуальные переменные:   
- **EMAIL_HOST** - почтовый профиль, с которого будет отправлено письмо для задания от клиента компании   
- **EMAIL_HOST_PASSWORD** - пароль к почтовому профилю, с которого будет отправлено письмо для задания от клиента компании  
- **REDIS_HOST** - адрес сервера с запущенным Redis  
- **POSTGRES_DB** - имя базы данных  
- **POSTGRES_USER** - имя пользователя для базы данных  
- **POSTGRES_PASSWORD** - пароль пользователя для СУБД  
- **POSTGRES_HOST**- адрес сервера с базой данных  
  
Также потребуется докачать все библиотеки, указанные в файле **requirements.txt** командой `pip install -r requirements.txt`.  
  
Далее можно запустить приложение командой `python manage.py runserver`.  
### Докер  
Для удобства я решил ввести докерфайл, который можно использовать для сборки образа приложения. Для этого достаточно создать в директории с проектом файл **proj.env** с необходимыми переменными окружения и ввести следующую команду, находясь в директории проекта:  
`docker-compose up`  
  
# Уточнения по деталям реализации
  
## Создание робота.  
Для создания робота был выбран путь **/robots/**, на который надо отправлять **POST** запрос с указанными данными робота в теле ответа. Валидация указанных данных происходит с помощью класса **RobotCreateValidator**, описанного в файле **robots/validation.py**. Если данные не прошли валидацию, вызывается исключение, описанное в **R4C/exceptions.py**. Все кастомные исключения обрабатываются с использованием **middlewares**. Мой собственный **middleware** прописан в **R4C/middleware.py**. В случае, если запрос прошёл успешно, возвращается ответ с кодом 200 и телом ответа, где передается слово "**success**".

Пример запроса/ответа:
`HTTP REQUEST`
`JSON BODY: {"model":"R2","version":"D2","created":"2022-12-31 23:59:59"}`
___
`HTTP RESPONSE`
`STATUS 200`
`BODY "success"`
  
## Формирование отчёта в виде xlsx документа  
Для получения таблицы был выбран путь **/robots/table**, на который надо отправлять **GET** запрос без каких-либо данных. В ответ с использованием библиотеки **pandas** возвращается файл **robots.xlsx** с данными о роботах, созданных за последнюю неделю, сгруппированных по модели.  
  
## Уведомление пользователя при создании робота, которого он заказал  
Для выполнения этого задания был добавлен путь для создания заказа: **/orders/**, на который надо отправлять **POST** запрос с данными о почте пользователя и серийном слове робота. Для этого задания в модель заказа было добавлено поле **in_waiting**, дабы отслеживать, какому пользователю стоит отправлять письмо о появлении нужного ему робота в ассортименте. При создании записи о роботе в базе данных срабатывает сигнал **notification_email**, прописанный в файле **robots/signals.py**. Если серийное слово робота соответствует заказу, у которого стоит состояние **in_waiting**, пользователю присылается письмо в формате, указанном в задании. 

Пример запроса/ответа для создания заказа на робота:

`HTTP REQUEST`
`JSON BODY: {"email": "some_email@some.com", "serial": "R2-D2"}`
___
`HTTP RESPONSE`
`STATUS 200`
`BODY "success"`
  